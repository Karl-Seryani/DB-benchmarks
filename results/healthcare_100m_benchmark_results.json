{
  "dataset": "healthcare_100m",
  "timestamp": "2025-12-01T02:45:16.338711",
  "config": {
    "warmup_runs": 2,
    "measured_runs": 5
  },
  "benchmarks": {
    "query": {
      "simple_aggregation": {
        "name": "Simple Aggregation",
        "description": "COUNT and AVG cost grouped by department",
        "category": "query",
        "clickhouse": {
          "avg_time": 688.8037204742432,
          "min_time": 676.6741275787354,
          "max_time": 699.8498439788818,
          "std_dev": 8.628484752375659,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    COUNT(*) as event_count,\n                    AVG(cost_usd) as avg_cost\n                FROM healthcare_100m.medical_events\n                GROUP BY department\n                ORDER BY event_count DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": 33.579206466674805,
          "min_time": 31.96406364440918,
          "max_time": 36.81588172912598,
          "std_dev": 1.9849763682193928,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_department": {
                "terms": {
                  "field": "department",
                  "size": 20,
                  "order": {
                    "_count": "desc"
                  }
                },
                "aggs": {
                  "avg_cost": {
                    "avg": {
                      "field": "cost_usd"
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 20.512805183703087,
        "why_compared": "Basic OLAP operation - tests aggregation performance"
      },
      "time_series": {
        "name": "Time-Series Analysis",
        "description": "Daily aggregation with date bucketing (last 30 days)",
        "category": "query",
        "clickhouse": {
          "avg_time": 441.66741371154785,
          "min_time": 431.347131729126,
          "max_time": 449.8329162597656,
          "std_dev": 7.975930120628313,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    toDate(timestamp) as date,\n                    COUNT(*) as event_count,\n                    SUM(cost_usd) as daily_revenue\n                FROM healthcare_100m.medical_events\n                GROUP BY date\n                ORDER BY date DESC\n                LIMIT 30\n            ",
          "row_count": 30
        },
        "elasticsearch": {
          "avg_time": 50.36807060241699,
          "min_time": 45.88007926940918,
          "max_time": 56.24222755432129,
          "std_dev": 3.8619866839524684,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_date": {
                "date_histogram": {
                  "field": "timestamp",
                  "calendar_interval": "day",
                  "order": {
                    "_key": "desc"
                  }
                },
                "aggs": {
                  "daily_revenue": {
                    "sum": {
                      "field": "cost_usd"
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 8.768797542353225,
        "why_compared": "Common time-series pattern - tests date handling"
      },
      "fulltext_search": {
        "name": "Full-Text Search",
        "description": "Search for \"Surgery\" or \"Emergency\" events",
        "category": "query",
        "clickhouse": {
          "avg_time": 652.9974937438965,
          "min_time": 644.3867683410645,
          "max_time": 661.2472534179688,
          "std_dev": 6.907735846207616,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    event_type,\n                    COUNT(*) as match_count\n                FROM healthcare_100m.medical_events\n                WHERE event_type LIKE '%Surgery%' OR event_type LIKE '%Emergency%'\n                GROUP BY event_type\n                ORDER BY match_count DESC\n            ",
          "row_count": 2
        },
        "elasticsearch": {
          "avg_time": 35.63437461853027,
          "min_time": 32.50408172607422,
          "max_time": 40.410757064819336,
          "std_dev": 3.172099372911823,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "query": {
              "bool": {
                "should": [
                  {
                    "match": {
                      "event_type": "Surgery"
                    }
                  },
                  {
                    "match": {
                      "event_type": "Emergency"
                    }
                  }
                ]
              }
            },
            "aggs": {
              "by_event_type": {
                "terms": {
                  "field": "event_type",
                  "size": 20
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 18.324932056035873,
        "why_compared": "ES designed for this - inverted index vs LIKE scan",
        "note": "ES uses inverted index (optimized), CH uses LIKE scan (not optimized)"
      },
      "top_n": {
        "name": "Top-N Query",
        "description": "Find top 10 highest-cost events",
        "category": "query",
        "clickhouse": {
          "avg_time": 330.48624992370605,
          "min_time": 325.84190368652344,
          "max_time": 337.3091220855713,
          "std_dev": 4.403711316943056,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    event_id,\n                    patient_id,\n                    department,\n                    cost_usd\n                FROM healthcare_100m.medical_events\n                ORDER BY cost_usd DESC\n                LIMIT 10\n            ",
          "row_count": 10
        },
        "elasticsearch": {
          "avg_time": 42.82569885253906,
          "min_time": 40.01593589782715,
          "max_time": 47.80316352844238,
          "std_dev": 2.979494184657252,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 10,
            "sort": [
              {
                "cost_usd": "desc"
              }
            ],
            "_source": [
              "event_id",
              "patient_id",
              "department",
              "cost_usd"
            ]
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 7.717007749521222,
        "why_compared": "Common pattern - tests sorting and limiting"
      },
      "multi_metric": {
        "name": "Multi-Metric Dashboard",
        "description": "Department dashboard with 6 metrics (COUNT, unique patients, revenue, avg cost, avg duration, critical cases)",
        "category": "query",
        "clickhouse": {
          "avg_time": 2444.648027420044,
          "min_time": 2336.970090866089,
          "max_time": 2539.048910140991,
          "std_dev": 89.53892618625356,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    COUNT(*) as total_events,\n                    COUNT(DISTINCT patient_id) as unique_patients,\n                    SUM(cost_usd) as total_revenue,\n                    AVG(cost_usd) as avg_cost,\n                    AVG(duration_minutes) as avg_duration,\n                    SUM(CASE WHEN severity = 'Critical' THEN 1 ELSE 0 END) as critical_cases\n                FROM healthcare_100m.medical_events\n                GROUP BY department\n                ORDER BY total_revenue DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": 102.29306221008301,
          "min_time": 82.34381675720215,
          "max_time": 146.44408226013184,
          "std_dev": 27.957723969978193,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_department": {
                "terms": {
                  "field": "department",
                  "size": 20,
                  "order": {
                    "total_revenue": "desc"
                  }
                },
                "aggs": {
                  "unique_patients": {
                    "cardinality": {
                      "field": "patient_id"
                    }
                  },
                  "total_revenue": {
                    "sum": {
                      "field": "cost_usd"
                    }
                  },
                  "avg_cost": {
                    "avg": {
                      "field": "cost_usd"
                    }
                  },
                  "avg_duration": {
                    "avg": {
                      "field": "duration_minutes"
                    }
                  },
                  "critical_cases": {
                    "filter": {
                      "term": {
                        "severity": "Critical"
                      }
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 23.898473411612027,
        "why_compared": "Complex aggregation - tests multi-metric performance"
      }
    },
    "capability": {
      "patient_event_join": {
        "name": "Patient-Event JOIN",
        "description": "Join patients with their medical events by condition and insurance",
        "category": "capability",
        "clickhouse": {
          "avg_time": 2132.041645050049,
          "min_time": 2096.4739322662354,
          "max_time": 2144.804000854492,
          "std_dev": 20.080337202917843,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    p.primary_condition,\n                    p.insurance_type,\n                    COUNT(*) as event_count,\n                    AVG(e.cost_usd) as avg_cost,\n                    SUM(e.cost_usd) as total_cost\n                FROM healthcare_100m.patients p\n                JOIN healthcare_100m.medical_events e ON p.patient_id = e.patient_id\n                GROUP BY p.primary_condition, p.insurance_type\n                ORDER BY total_cost DESC\n                LIMIT 20\n            ",
          "row_count": 20
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot perform JOINs. Apps must denormalize data (duplicating storage) or run multiple queries and join in application code (slower, more complex)."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot perform JOINs. Apps must denormalize data (duplicating storage) or run multiple queries and join in application code (slower, more complex).",
        "es_not_possible": true,
        "why_compared": "Healthcare apps need JOINs constantly"
      },
      "cost_by_condition": {
        "name": "Cost by Condition",
        "description": "Total healthcare cost per patient condition (requires JOIN)",
        "category": "capability",
        "clickhouse": {
          "avg_time": 2136.026430130005,
          "min_time": 2088.886022567749,
          "max_time": 2186.58709526062,
          "std_dev": 38.24378338095985,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    p.primary_condition,\n                    COUNT(DISTINCT p.patient_id) as patient_count,\n                    COUNT(*) as event_count,\n                    SUM(e.cost_usd) as total_cost,\n                    AVG(e.cost_usd) as avg_cost_per_event\n                FROM healthcare_100m.patients p\n                JOIN healthcare_100m.medical_events e ON p.patient_id = e.patient_id\n                GROUP BY p.primary_condition\n                ORDER BY total_cost DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot join patient conditions with event costs. This is why mpathic switched - their data scientists needed this for ML experiments."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot join patient conditions with event costs. This is why mpathic switched - their data scientists needed this for ML experiments.",
        "es_not_possible": true,
        "why_compared": "Critical for healthcare cost analysis - mpathic use case"
      },
      "anomaly_detection": {
        "name": "Anomaly Detection",
        "description": "Find events with cost above average (subquery)",
        "category": "capability",
        "clickhouse": {
          "avg_time": 1219.9585437774658,
          "min_time": 1212.4199867248535,
          "max_time": 1228.2829284667969,
          "std_dev": 7.098238750420125,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    severity,\n                    COUNT(*) as high_cost_events,\n                    AVG(cost_usd) as avg_high_cost\n                FROM healthcare_100m.medical_events\n                WHERE cost_usd > (\n                    SELECT AVG(cost_usd) FROM healthcare_100m.medical_events\n                )\n                GROUP BY department, severity\n                ORDER BY high_cost_events DESC\n            ",
          "row_count": 60
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot execute subqueries. To find above-average events: 1) Query to get average, 2) Second query with that value. Doubles latency, complicates code."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot execute subqueries. To find above-average events: 1) Query to get average, 2) Second query with that value. Doubles latency, complicates code.",
        "es_not_possible": true,
        "why_compared": "Common analytics pattern - requires subquery support"
      }
    }
  },
  "summary": {
    "query": {
      "clickhouse_wins": 0,
      "elasticsearch_wins": 5
    },
    "capability": {
      "clickhouse_wins": 0,
      "es_not_possible": 3
    }
  }
}