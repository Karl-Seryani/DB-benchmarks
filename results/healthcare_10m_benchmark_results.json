{
  "dataset": "healthcare_10m",
  "timestamp": "2025-12-01T02:44:57.522131",
  "config": {
    "warmup_runs": 2,
    "measured_runs": 5
  },
  "benchmarks": {
    "query": {
      "simple_aggregation": {
        "name": "Simple Aggregation",
        "description": "COUNT and AVG cost grouped by department",
        "category": "query",
        "clickhouse": {
          "avg_time": 127.7853012084961,
          "min_time": 125.86808204650879,
          "max_time": 129.08315658569336,
          "std_dev": 1.6292097494056148,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    COUNT(*) as event_count,\n                    AVG(cost_usd) as avg_cost\n                FROM healthcare_10m.medical_events\n                GROUP BY department\n                ORDER BY event_count DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": 34.1221809387207,
          "min_time": 32.61899948120117,
          "max_time": 36.756038665771484,
          "std_dev": 1.5806596409633777,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_department": {
                "terms": {
                  "field": "department",
                  "size": 20,
                  "order": {
                    "_count": "desc"
                  }
                },
                "aggs": {
                  "avg_cost": {
                    "avg": {
                      "field": "cost_usd"
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 3.7449335796555028,
        "why_compared": "Basic OLAP operation - tests aggregation performance"
      },
      "time_series": {
        "name": "Time-Series Analysis",
        "description": "Daily aggregation with date bucketing (last 30 days)",
        "category": "query",
        "clickhouse": {
          "avg_time": 103.55310440063477,
          "min_time": 98.45709800720215,
          "max_time": 106.68778419494629,
          "std_dev": 3.17498703122367,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    toDate(timestamp) as date,\n                    COUNT(*) as event_count,\n                    SUM(cost_usd) as daily_revenue\n                FROM healthcare_10m.medical_events\n                GROUP BY date\n                ORDER BY date DESC\n                LIMIT 30\n            ",
          "row_count": 30
        },
        "elasticsearch": {
          "avg_time": 56.88652992248535,
          "min_time": 52.21891403198242,
          "max_time": 62.28804588317871,
          "std_dev": 3.7404994119716473,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_date": {
                "date_histogram": {
                  "field": "timestamp",
                  "calendar_interval": "day",
                  "order": {
                    "_key": "desc"
                  }
                },
                "aggs": {
                  "daily_revenue": {
                    "sum": {
                      "field": "cost_usd"
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 1.8203448960894286,
        "why_compared": "Common time-series pattern - tests date handling"
      },
      "fulltext_search": {
        "name": "Full-Text Search",
        "description": "Search for \"Surgery\" or \"Emergency\" events",
        "category": "query",
        "clickhouse": {
          "avg_time": 124.26643371582031,
          "min_time": 121.31094932556152,
          "max_time": 125.79894065856934,
          "std_dev": 1.8284379930658117,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    event_type,\n                    COUNT(*) as match_count\n                FROM healthcare_10m.medical_events\n                WHERE event_type LIKE '%Surgery%' OR event_type LIKE '%Emergency%'\n                GROUP BY event_type\n                ORDER BY match_count DESC\n            ",
          "row_count": 2
        },
        "elasticsearch": {
          "avg_time": 34.23647880554199,
          "min_time": 33.00309181213379,
          "max_time": 35.86602210998535,
          "std_dev": 1.0523212361146228,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "query": {
              "bool": {
                "should": [
                  {
                    "match": {
                      "event_type": "Surgery"
                    }
                  },
                  {
                    "match": {
                      "event_type": "Emergency"
                    }
                  }
                ]
              }
            },
            "aggs": {
              "by_event_type": {
                "terms": {
                  "field": "event_type",
                  "size": 20
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 3.629649953829505,
        "why_compared": "ES designed for this - inverted index vs LIKE scan",
        "note": "ES uses inverted index (optimized), CH uses LIKE scan (not optimized)"
      },
      "top_n": {
        "name": "Top-N Query",
        "description": "Find top 10 highest-cost events",
        "category": "query",
        "clickhouse": {
          "avg_time": 97.58210182189941,
          "min_time": 95.3671932220459,
          "max_time": 99.49088096618652,
          "std_dev": 1.5111719332101654,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    event_id,\n                    patient_id,\n                    department,\n                    cost_usd\n                FROM healthcare_10m.medical_events\n                ORDER BY cost_usd DESC\n                LIMIT 10\n            ",
          "row_count": 10
        },
        "elasticsearch": {
          "avg_time": 37.71672248840332,
          "min_time": 37.082672119140625,
          "max_time": 38.414955139160156,
          "std_dev": 0.6423996624119056,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 10,
            "sort": [
              {
                "cost_usd": "desc"
              }
            ],
            "_source": [
              "event_id",
              "patient_id",
              "department",
              "cost_usd"
            ]
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 2.5872370498762924,
        "why_compared": "Common pattern - tests sorting and limiting"
      },
      "multi_metric": {
        "name": "Multi-Metric Dashboard",
        "description": "Department dashboard with 6 metrics (COUNT, unique patients, revenue, avg cost, avg duration, critical cases)",
        "category": "query",
        "clickhouse": {
          "avg_time": 247.99466133117676,
          "min_time": 239.62998390197754,
          "max_time": 256.93392753601074,
          "std_dev": 6.167505323426687,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    COUNT(*) as total_events,\n                    COUNT(DISTINCT patient_id) as unique_patients,\n                    SUM(cost_usd) as total_revenue,\n                    AVG(cost_usd) as avg_cost,\n                    AVG(duration_minutes) as avg_duration,\n                    SUM(CASE WHEN severity = 'Critical' THEN 1 ELSE 0 END) as critical_cases\n                FROM healthcare_10m.medical_events\n                GROUP BY department\n                ORDER BY total_revenue DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": 83.62016677856445,
          "min_time": 77.3921012878418,
          "max_time": 88.9427661895752,
          "std_dev": 4.53545498065939,
          "runs": 5,
          "warmup_runs": 2,
          "query": {
            "size": 0,
            "aggs": {
              "by_department": {
                "terms": {
                  "field": "department",
                  "size": 20,
                  "order": {
                    "total_revenue": "desc"
                  }
                },
                "aggs": {
                  "unique_patients": {
                    "cardinality": {
                      "field": "patient_id"
                    }
                  },
                  "total_revenue": {
                    "sum": {
                      "field": "cost_usd"
                    }
                  },
                  "avg_cost": {
                    "avg": {
                      "field": "cost_usd"
                    }
                  },
                  "avg_duration": {
                    "avg": {
                      "field": "duration_minutes"
                    }
                  },
                  "critical_cases": {
                    "filter": {
                      "term": {
                        "severity": "Critical"
                      }
                    }
                  }
                }
              }
            }
          },
          "hits": 10000
        },
        "winner": "elasticsearch",
        "speedup": 2.96572789657182,
        "why_compared": "Complex aggregation - tests multi-metric performance"
      }
    },
    "capability": {
      "patient_event_join": {
        "name": "Patient-Event JOIN",
        "description": "Join patients with their medical events by condition and insurance",
        "category": "capability",
        "clickhouse": {
          "avg_time": 282.3188781738281,
          "min_time": 277.1117687225342,
          "max_time": 285.2978706359863,
          "std_dev": 3.1261268141226926,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    p.primary_condition,\n                    p.insurance_type,\n                    COUNT(*) as event_count,\n                    AVG(e.cost_usd) as avg_cost,\n                    SUM(e.cost_usd) as total_cost\n                FROM healthcare_10m.patients p\n                JOIN healthcare_10m.medical_events e ON p.patient_id = e.patient_id\n                GROUP BY p.primary_condition, p.insurance_type\n                ORDER BY total_cost DESC\n                LIMIT 20\n            ",
          "row_count": 20
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot perform JOINs. Apps must denormalize data (duplicating storage) or run multiple queries and join in application code (slower, more complex)."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot perform JOINs. Apps must denormalize data (duplicating storage) or run multiple queries and join in application code (slower, more complex).",
        "es_not_possible": true,
        "why_compared": "Healthcare apps need JOINs constantly"
      },
      "cost_by_condition": {
        "name": "Cost by Condition",
        "description": "Total healthcare cost per patient condition (requires JOIN)",
        "category": "capability",
        "clickhouse": {
          "avg_time": 294.09642219543457,
          "min_time": 268.9778804779053,
          "max_time": 312.9229545593262,
          "std_dev": 18.131949476589334,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    p.primary_condition,\n                    COUNT(DISTINCT p.patient_id) as patient_count,\n                    COUNT(*) as event_count,\n                    SUM(e.cost_usd) as total_cost,\n                    AVG(e.cost_usd) as avg_cost_per_event\n                FROM healthcare_10m.patients p\n                JOIN healthcare_10m.medical_events e ON p.patient_id = e.patient_id\n                GROUP BY p.primary_condition\n                ORDER BY total_cost DESC\n            ",
          "row_count": 15
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot join patient conditions with event costs. This is why mpathic switched - their data scientists needed this for ML experiments."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot join patient conditions with event costs. This is why mpathic switched - their data scientists needed this for ML experiments.",
        "es_not_possible": true,
        "why_compared": "Critical for healthcare cost analysis - mpathic use case"
      },
      "anomaly_detection": {
        "name": "Anomaly Detection",
        "description": "Find events with cost above average (subquery)",
        "category": "capability",
        "clickhouse": {
          "avg_time": 184.95097160339355,
          "min_time": 178.26485633850098,
          "max_time": 195.9829330444336,
          "std_dev": 8.365212291921713,
          "runs": 5,
          "warmup_runs": 2,
          "query": "\n                SELECT\n                    department,\n                    severity,\n                    COUNT(*) as high_cost_events,\n                    AVG(cost_usd) as avg_high_cost\n                FROM healthcare_10m.medical_events\n                WHERE cost_usd > (\n                    SELECT AVG(cost_usd) FROM healthcare_10m.medical_events\n                )\n                GROUP BY department, severity\n                ORDER BY high_cost_events DESC\n            ",
          "row_count": 60
        },
        "elasticsearch": {
          "avg_time": null,
          "not_possible": true,
          "limitation": "Elasticsearch cannot execute subqueries. To find above-average events: 1) Query to get average, 2) Second query with that value. Doubles latency, complicates code."
        },
        "winner": "clickhouse",
        "speedup": null,
        "es_limitation": "Elasticsearch cannot execute subqueries. To find above-average events: 1) Query to get average, 2) Second query with that value. Doubles latency, complicates code.",
        "es_not_possible": true,
        "why_compared": "Common analytics pattern - requires subquery support"
      }
    }
  },
  "summary": {
    "query": {
      "clickhouse_wins": 0,
      "elasticsearch_wins": 5
    },
    "capability": {
      "clickhouse_wins": 0,
      "es_not_possible": 3
    }
  }
}